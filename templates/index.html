<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé¨ NeuroAnalyzer - –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∫–∏–Ω–æ–û—Ç–∑—ã–≤–æ–≤</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 20px;
            padding: 50px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 25px 0;
            background: var(--bg-secondary);
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: var(--bg-primary);
        }

        .upload-area.dragover {
            border-color: var(--primary);
            background: var(--bg-primary);
            animation: pulse 1s infinite;
        }

        .file-info {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            border-left: 4px solid var(--primary);
        }

        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border-left: 4px solid var(--border);
        }

        .stat-card.positive { border-left-color: var(--success); }
        .stat-card.negative { border-left-color: var(--danger); }
        .stat-card.neutral { border-left-color: var(--warning); }
        .stat-card.total { border-left-color: var(--primary); }

        .stat-value {
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .stat-card.positive .stat-value { color: var(--success); }
        .stat-card.negative .stat-value { color: var(--danger); }
        .stat-card.neutral .stat-value { color: var(--warning); }
        .stat-card.total .stat-value { color: var(--primary); }

        .review-item {
            background: var(--bg-primary);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid var(--border);
        }

        .review-item.positive { border-left-color: var(--success); }
        .review-item.negative { border-left-color: var(--danger); }
        .review-item.neutral { border-left-color: var(--warning); }

        .ml-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .ml-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ml-btn.collect {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .ml-btn.retrain {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .ml-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .ml-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="header glass-effect">
            <h1>üé¨ NeuroAnalyzer</h1>
            <p>–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–∏–Ω–æ–û—Ç–∑—ã–≤–æ–≤</p>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main>
            <!-- –°–µ–∫—Ü–∏—è –≤–≤–æ–¥–∞ -->
            <section class="input-section glass-effect">
                <h2>üí≠ –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤</h2>
                <textarea id="reviewText" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤ –æ —Ñ–∏–ª—å–º–µ..."></textarea>
                <button id="analyzeBtn" onclick="analyzeReview()">
                    <span id="btnText">üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∑—ã–≤</span>
                </button>
                <div class="loading-bar" id="loadingBar" style="display: none;">
                    <div class="loading-progress"></div>
                </div>
            </section>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
            <section id="result" class="result glass-effect" style="display: none;">
                <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞</h3>
                <div id="sentimentResult" class="sentiment">
                    <span id="sentimentEmoji"></span>
                    <span id="sentimentText" class="sentiment-text"></span>
                </div>
                <div id="translationResult" class="translation"></div>
                <div class="confidence-section">
                    <div id="confidenceResult" class="confidence-text">
                        <span>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞:</span>
                        <span id="confidenceValue">0%</span>
                    </div>
                    <div class="confidence-bar">
                        <div id="confidenceFill" class="confidence-fill"></div>
                    </div>
                </div>
            </section>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ML –º–æ–¥–µ–ª—å—é -->
            <section class="ml-controls-section glass-effect">
                <h2>üß† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ML –ú–æ–¥–µ–ª—å—é</h2>
                <p>–°–æ–±–µ—Ä–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Ç–∑—ã–≤—ã –∏ –ø–µ—Ä–µ–æ–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è –ª—É—á—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç–∏</p>
                
                <div class="ml-controls">
                    <button class="ml-btn collect" onclick="collectReviews()" id="collectBtn">
                        <span id="collectBtnText">üé¨ –°–æ–±—Ä–∞—Ç—å –æ—Ç–∑—ã–≤—ã —Å –ö–∏–Ω–æ–ø–æ–∏—Å–∫–∞</span>
                    </button>
                    <button class="ml-btn retrain" onclick="retrainModel()" id="retrainBtn">
                        <span id="retrainBtnText">üîÑ –ü–µ—Ä–µ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å</span>
                    </button>
                </div>
                
                <div class="loading-bar" id="mlLoadingBar" style="display: none;">
                    <div class="loading-progress"></div>
                </div>
                
                <div id="mlResult" style="display: none; margin-top: 20px; padding: 15px; border-radius: 10px; background: var(--bg-secondary);"></div>
            </section>

            <!-- –ü—Ä–∏–º–µ—Ä—ã -->
            <section class="examples glass-effect">
                <h4>üöÄ –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–∏–º–µ—Ä—ã</h4>
                <div class="example-buttons">
                    <button class="example-btn" onclick="setExample('–§–∏–ª—å–º –ø—Ä–æ—Å—Ç–æ –≤–µ–ª–∏–∫–æ–ª–µ–ø–µ–Ω!')">üòä –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π</button>
                    <button class="example-btn" onclick="setExample('–ü–æ–ª–Ω–∞—è —Ö—É–π–Ω—è!')">üò† –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π</button>
                </div>
            </section>

            <!-- –°–µ–∫—Ü–∏—è –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ -->
            <section class="batch-section glass-effect">
                <h2>üìÅ –ü–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏–∑ —Ñ–∞–π–ª–∞</h2>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ .txt —Ñ–∞–π–ª —Å –æ—Ç–∑—ã–≤–∞–º–∏ (–∫–∞–∂–¥—ã–π –æ—Ç–∑—ã–≤ –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ)</p>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <div style="font-size: 3em; margin-bottom: 15px;">üìÑ</div>
                        <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ .txt —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                        <small>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã</small>
                    </div>
                    <input type="file" id="fileInput" accept=".txt" style="display: none;">
                </div>
                
                <button id="analyzeBatchBtn" onclick="analyzeBatch()" style="display: none; width: 100%; margin-top: 20px; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; cursor: pointer;">
                    <span id="batchBtnText">üìä –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª</span>
                </button>
                
                <div class="loading-bar" id="batchLoadingBar" style="display: none;">
                    <div class="loading-progress"></div>
                </div>
            </section>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ -->
            <section id="batchResult" class="batch-result glass-effect" style="display: none;">
                <h3>üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</h3>
                
                <div class="statistics-grid">
                    <div class="stat-card positive">
                        <div class="stat-value" id="statPositive">0</div>
                        <div class="stat-label">–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ</div>
                    </div>
                    <div class="stat-card negative">
                        <div class="stat-value" id="statNegative">0</div>
                        <div class="stat-label">–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ</div>
                    </div>
                    <div class="stat-card neutral">
                        <div class="stat-value" id="statNeutral">0</div>
                        <div class="stat-label">–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ</div>
                    </div>
                    <div class="stat-card total">
                        <div class="stat-value" id="statTotal">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –æ—Ç–∑—ã–≤–æ–≤</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 2em; margin-bottom: 10px;">üìä</div>
                        <h3 style="color: var(--text-primary); margin-bottom: 15px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞</h3>
                                                <div id="textStats" style="text-align: left; display: inline-block; color: var(--text-secondary); line-height: 1.6;">
                            <!-- –¢–µ–∫—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                </div>
                
                <div class="details-section">
                    <h4>üìã –î–µ—Ç–∞–ª–∏ –∞–Ω–∞–ª–∏–∑–∞</h4>
                    <div id="batchDetails" class="details-content" style="max-height: 400px; overflow-y: auto; background: var(--bg-secondary); border-radius: 10px; padding: 20px;"></div>
                </div>
            </section>
        </main>

        <!-- –ü–æ–¥–≤–∞–ª -->
        <footer class="footer">
            <p>‚ú® –ë—ã—Å—Ç—Ä–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏</p>
            <p>üéØ –¢–æ—á–Ω–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞: –¥–æ 95%</p>
            <p>üß† –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ML –º–æ–¥–µ–ª—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</p>
        </footer>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        let selectedFile = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            setupFileUpload();
            console.log('üöÄ NeuroAnalyzer –∑–∞–≥—Ä—É–∂–µ–Ω —Å ML –º–æ–¥–µ–ª—å—é!');
        });

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
        function setupFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            // –ö–ª–∏–∫ –ø–æ –æ–±–ª–∞—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏
            uploadArea.addEventListener('click', () => {
                fileInput.click();
            });

            // –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ input
            fileInput.addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    handleFileSelect(this.files[0]);
                }
            });

            // Drag and drop
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                if (e.dataTransfer.files.length > 0) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        function handleFileSelect(file) {
            if (file && file.name.toLowerCase().endsWith('.txt')) {
                selectedFile = file;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
                document.getElementById('uploadArea').innerHTML = `
                    <div class="upload-content">
                        <div style="font-size: 3em; margin-bottom: 15px;">‚úÖ</div>
                        <p><strong>${file.name}</strong></p>
                        <small>–§–∞–π–ª –≥–æ—Ç–æ–≤ –∫ –∞–Ω–∞–ª–∏–∑—É</small>
                        <div class="file-info">
                            <div>–†–∞–∑–º–µ—Ä: ${(file.size / 1024).toFixed(2)} KB</div>
                            <div>–¢–∏–ø: ${file.type || 'text/plain'}</div>
                        </div>
                    </div>
                `;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–Ω–∞–ª–∏–∑–∞
                document.getElementById('analyzeBatchBtn').style.display = 'block';

            } else {
                showNotification('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ .txt —Ñ–∞–π–ª', 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è ML —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        async function collectReviews() {
            const button = document.getElementById('collectBtn');
            const btnText = document.getElementById('collectBtnText');
            const loadingBar = document.getElementById('mlLoadingBar');
            const resultDiv = document.getElementById('mlResult');

            btnText.innerHTML = '‚è≥ –°–æ–±–∏—Ä–∞–µ–º –æ—Ç–∑—ã–≤—ã...';
            button.disabled = true;
            loadingBar.style.display = 'block';
            resultDiv.style.display = 'none';

            try {
                const response = await fetch('/collect_reviews');
                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `
                        <div style="color: var(--success);">
                            <h4>‚úÖ –°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω!</h4>
                            <p>–ü–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤: <strong>${data.positive_collected}</strong></p>
                            <p>–ù–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤: <strong>${data.negative_collected}</strong></p>
                            <p>${data.message}</p>
                        </div>
                    `;
                    showNotification('‚úÖ –û—Ç–∑—ã–≤—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω—ã —Å –ö–∏–Ω–æ–ø–æ–∏—Å–∫–∞!', 'success');
                } else {
                    throw new Error(data.error);
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞ –æ—Ç–∑—ã–≤–æ–≤:', error);
                resultDiv.innerHTML = `
                    <div style="color: var(--danger);">
                        <h4>‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞ –æ—Ç–∑—ã–≤–æ–≤</h4>
                        <p>${error.message}</p>
                    </div>
                `;
                showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–µ –æ—Ç–∑—ã–≤–æ–≤', 'error');
            } finally {
                btnText.innerHTML = 'üé¨ –°–æ–±—Ä–∞—Ç—å –æ—Ç–∑—ã–≤—ã —Å –ö–∏–Ω–æ–ø–æ–∏—Å–∫–∞';
                button.disabled = false;
                loadingBar.style.display = 'none';
                resultDiv.style.display = 'block';
            }
        }

        async function retrainModel() {
            const button = document.getElementById('retrainBtn');
            const btnText = document.getElementById('retrainBtnText');
            const loadingBar = document.getElementById('mlLoadingBar');
            const resultDiv = document.getElementById('mlResult');

            btnText.innerHTML = '‚è≥ –ü–µ—Ä–µ–æ–±—É—á–∞–µ–º –º–æ–¥–µ–ª—å...';
            button.disabled = true;
            loadingBar.style.display = 'block';
            resultDiv.style.display = 'none';

            try {
                const response = await fetch('/retrain_with_real_data');
                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `
                        <div style="color: var(--success);">
                            <h4>‚úÖ –ú–æ–¥–µ–ª—å –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∞!</h4>
                            <p>${data.message}</p>
                            <p>–¢–µ–ø–µ—Ä—å –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –ö–∏–Ω–æ–ø–æ–∏—Å–∫–∞</p>
                        </div>
                    `;
                    showNotification('‚úÖ –ú–æ–¥–µ–ª—å —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∞!', 'success');
                } else {
                    throw new Error(data.error);
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è:', error);
                resultDiv.innerHTML = `
                    <div style="color: var(--danger);">
                        <h4>‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è</h4>
                        <p>${error.message}</p>
                    </div>
                `;
                showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏', 'error');
            } finally {
                btnText.innerHTML = 'üîÑ –ü–µ—Ä–µ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å';
                button.disabled = false;
                loadingBar.style.display = 'none';
                resultDiv.style.display = 'block';
            }
        }

        // –ê–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–∞
        async function analyzeBatch() {
            if (!selectedFile) {
                showNotification('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª', 'error');
                return;
            }

            const button = document.getElementById('analyzeBatchBtn');
            const btnText = document.getElementById('batchBtnText');
            const loadingBar = document.getElementById('batchLoadingBar');

            btnText.innerHTML = '‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...';
            button.disabled = true;
            loadingBar.style.display = 'block';

            try {
                const formData = new FormData();
                formData.append('file', selectedFile);

                const response = await fetch('/analyze_batch', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                }

                const data = await response.json();

                if (data.success) {
                    displayBatchResult(data);
                    showNotification(`‚úÖ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ${data.processed_count} –æ—Ç–∑—ã–≤–æ–≤`, 'success');
                } else {
                    throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showNotification(`‚ùå ${error.message}`, 'error');
            } finally {
                btnText.innerHTML = 'üìä –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª';
                button.disabled = false;
                loadingBar.style.display = 'none';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
        function displayBatchResult(data) {
            const resultDiv = document.getElementById('batchResult');
            const stats = data.statistics;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('statTotal').textContent = stats.total;
            document.getElementById('statPositive').textContent = stats.positive;
            document.getElementById('statNegative').textContent = stats.negative;
            document.getElementById('statNeutral').textContent = stats.neutral;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const textStatsDiv = document.getElementById('textStats');
            const positivePercent = stats.total > 0 ? (stats.positive / stats.total * 100).toFixed(1) : 0;
            const negativePercent = stats.total > 0 ? (stats.negative / stats.total * 100).toFixed(1) : 0;
            const neutralPercent = stats.total > 0 ? (stats.neutral / stats.total * 100).toFixed(1) : 0;

            textStatsDiv.innerHTML = `
                <div style="margin: 10px 0;">‚úÖ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ: <strong>${stats.positive}</strong> (${positivePercent}%)</div>
                <div style="margin: 10px 0;">‚ùå –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ: <strong>${stats.negative}</strong> (${negativePercent}%)</div>
                <div style="margin: 10px 0;">üòê –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ: <strong>${stats.neutral}</strong> (${neutralPercent}%)</div>
                <div style="margin: 10px 0;">‚ö†Ô∏è –û—à–∏–±–∫–∏: <strong>${stats.errors}</strong></div>
                <div style="margin: 20px 0 10px 0; border-top: 1px solid var(--border); padding-top: 10px;">
                    üìà –í—Å–µ–≥–æ –æ—Ç–∑—ã–≤–æ–≤: <strong>${stats.total}</strong>
                </div>
                <div style="margin: 10px 0;">
                    üéØ –°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: <strong>${(stats.avg_confidence * 100).toFixed(1)}%</strong>
                </div>
            `;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏
            const detailsDiv = document.getElementById('batchDetails');
            detailsDiv.innerHTML = '';

            data.results.slice(0, 50).forEach((result, index) => {
                const item = document.createElement('div');
                item.className = `review-item ${result.sentiment_ru.toLowerCase()}`;
                item.innerHTML = `
                    <div style="margin-bottom: 8px;"><strong>${index + 1}.</strong> ${result.original_text}</div>
                    <div style="display: flex; justify-content: space-between; align-items: center; font-weight: 600;">
                        <span>${result.emotion} ${result.sentiment_ru}</span>
                        <span>${(result.confidence * 100).toFixed(1)}%</span>
                    </div>
                `;
                detailsDiv.appendChild(item);
            });

            if (data.results.length > 50) {
                const moreText = document.createElement('div');
                moreText.style.textAlign = 'center';
                moreText.style.padding = '10px';
                moreText.style.color = 'var(--text-secondary)';
                moreText.textContent = `... –∏ –µ—â–µ ${data.results.length - 50} –æ—Ç–∑—ã–≤–æ–≤`;
                detailsDiv.appendChild(moreText);
            }

            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
        function setExample(text) {
            document.getElementById('reviewText').value = text;
        }

        async function analyzeReview() {
            const review = document.getElementById('reviewText').value.trim();
            if (!review) {
                showNotification('üìù –í–≤–µ–¥–∏—Ç–µ –æ—Ç–∑—ã–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞', 'warning');
                return;
            }

            const button = document.getElementById('analyzeBtn');
            const btnText = document.getElementById('btnText');
            const loadingBar = document.getElementById('loadingBar');

            btnText.innerHTML = '‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...';
            button.disabled = true;
            loadingBar.style.display = 'block';

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({review: review})
                });

                const data = await response.json();

                if (data.success) {
                    displayResult(data);
                    showNotification('‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!', 'success');
                } else {
                    throw new Error(data.error);
                }

            } catch (error) {
                console.error('Error:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ', 'error');
            } finally {
                btnText.innerHTML = 'üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∑—ã–≤';
                button.disabled = false;
                loadingBar.style.display = 'none';
            }
        }

        function displayResult(data) {
            const resultDiv = document.getElementById('result');
            const sentimentEmoji = document.getElementById('sentimentEmoji');
            const sentimentText = document.getElementById('sentimentText');
            const translationDiv = document.getElementById('translationResult');
            const confidenceValue = document.getElementById('confidenceValue');
            const confidenceFill = document.getElementById('confidenceFill');

            sentimentEmoji.innerHTML = data.emotion;
            sentimentText.innerHTML = data.sentiment_ru;
            translationDiv.innerHTML = `<strong>–¢–µ–∫—Å—Ç:</strong> "${data.original_text}"<br><strong>–ê–Ω–∞–ª–∏–∑:</strong> ${data.translated_text}`;
            confidenceValue.innerHTML = (data.confidence * 100).toFixed(1) + '%';

            confidenceFill.style.width = '0%';
            setTimeout(() => {
                confidenceFill.style.width = (data.confidence * 100) + '%';
            }, 100);

            resultDiv.className = 'result glass-effect';
            if (data.sentiment_ru === '–ü–û–ó–ò–¢–ò–í–ù–´–ô') {
                resultDiv.classList.add('positive');
            } else {
                resultDiv.classList.add('negative');
            }

            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type) {
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: 600;
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
                ${type === 'success' ? 'background: var(--success);' : 
                  type === 'warning' ? 'background: var(--warning);' : 
                  'background: var(--danger);'}
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeIn 0.3s ease-out reverse';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    </script>
</body>

</html>
